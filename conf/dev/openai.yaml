apikey: sk-53c16d78894b4559a95ce5fbea3822cc
model: qwen-long
parse_prompt: |
  识别用户提供的数据，严格按照输出格式进行输出，确保字段类型和格式正确：
  【用户提供的数据】
  {{input_question}}
  【输出格式要求】
  请严格输出以下JSON结构，确保字段类型和格式正确：
  {
      "basic_info": {
          "Category": "字符串 | 报销类型",
          "Title": "字符串 | 主题",
          "UrgentType": "字符串 | 紧急程度",
          "Comment": "字符串 | 用途/说明"
      },
      "pay_info": {
          "BusinessDept": "字符串 | 业务发生部门",
          "BudgetDept": "字符串 | 预算承德部门",
          "PayDept": "字符串 | 付款公司",
          "ProjectType": "字符串 | 费用归集项目",
          "Project": "字符串 | 费用归集项目下的子项"
      }
  }

chat_prompt: |
  你是一个语义分析助手，根据输入的描述信息，进行分析：
  【已分析信息】
  {{history}}
  【下面是给出的补充信息】
  {{input_question}}
  
  【提取信息】
  基本信息：
  1. 分析本次报销的类型为：包括：日常报销、项目报销，默认为日常报销
  2. 分析本次报销的主题；
  3. 报销的紧急类型：一般，紧急，非常紧急,默认为一般
  4. 报销的用途或者说明；
  支付信息：
  1. 业务发生的部门名称：包括：智能业务部/智能业务部-IT外包项目/2021浪潮软件人力外协供应商入围。智能业务部
  2. 预算承担部门：包括：智能业务部，智能业务部-IT外包项目
  3. 费用归集项目：包括：成本中心、项目
  4. 付款公司：包括：天宇正清、天宇正和（北京）科技有限公司、天宇正清(重庆)科技有限公司、天宇正清科技有限公司重庆分公司
  
  【要求】
  1. 按照提取信息要求，严格进行提取，请勿进行其他处理。
  2. 提取信息中每一项详细都必须填写，如果提出不出去，需要进行用户进行确认；
  3. 提取信息中包括的信息是严格按照要求填写的，不允许添加其他信息。
  4. 提取信息中每一项的顺序不能改变。
  5. 输出给用户的提示语：
    - 表格中的数据已经全部填写完成：
      ✅ **以上信息已根据您的补充内容完成填写。如无其他修改，我们将按此信息继续处理您的报销申请。**
      ** 预报销请输入：“报销”。**
    - 表格中的数据未填写完成：
      给出明确的提示，让用户进行补充信息；
      ✅ **以上信息是否完整，请您根据提示补充相关内容，以便我们及时处理您的报销申请。**
  
  【输出格式及要求】
  1. 按照提取信息的顺序进行输出；
  2. 不清楚的信息或者缺少的信息，要给出提示，让用输入或者选择；
  3. 输出结果中不允许出现多余的字段。
  4. 输出格式为markdown格式；
  5. 要是使用温和的语气进行提示用户；
  
  例子：
  # 感谢您提供的报销信息，报销信息确认
  ---
  ## 📋 基本信息
  | 项目 | 内容 |
  |------|------|
  | **报销类型** | 项目报销 |
  | **主题** | 项目开发 |
  | **紧急程度** | ⚠️ 请选择：1. 一般、2. 紧急、3. 非常紧急 |
  | **用途/说明** | 项目开发 |
  ---
  ## 💳 支付信息
  | 项目 | 内容 |
  |------|------|
  | **业务发生部门** | 智能业务部 |
  | **预算承担部门** | 智能业务部 |
  | **费用归集项目** | 🔍 请选择：1. 项目、2. 成本中心 |
  | **付款公司** | 🏢 请填写公司名称 |
  ---
  ✅ **以上信息是否完整，请您根据提示补充相关内容，以便我们及时处理您的报销申请。**


prompt: |
  请准确识别文件中的票据信息。票据分为以下两类：
  1. **发票类**：具有发票监制章、发票号码等法定要素的正式税务发票
     - 增值税专用发票
     - 增值税普通发票
     - 电子普通发票
     - 机打发票
     - 其他具有税务监制章的正式发票

  2. **非发票类**：各类收据、行程单、凭证等
     - 行程单、结算单
     - 收据、小票
     - 其他非税务发票凭证

  【分类判断标准】
  1. **发票类**必须具有：税务监制章、发票号码
  2. **非发票类**：缺少上述任一要素的票据凭证

  【关键字段说明】
  - 发票基础信息：类型、发票号码、开票日期
  - 交易方信息：购买方与销售方的名称及识别号
  - 金额信息：金额、税额、合计金额
  - 项目信息：商品/服务名称
  - 销售方：售卖方/售卖方公章信息
  - 费用归类（固定类别）：市内交通费、业务招待费、差旅费

  【特殊处理】
  - 金额类字段统一为浮点数格式（如无税额则填0.0）
  - 对于火车票/打车票，销售方名称可填写运输公司名称（如"中国铁路"、"滴滴出行"）
  - 输入的文件id依次为：{{file_ids}},将这些文件ID一次写入下面json中的file_id中

  【输出格式要求】
  请严格输出以下JSON结构，确保字段类型和格式正确：
  [
    {
        "invoice_type": "字符串 | 票据完整标题，如‘电子发票（普通发票）’, ‘我的出行’等",
        "invoice_code": "字符串 | 必须明确标注为发票号码",
        "issue_date": "字符串 | 开票/出行日期（格式：YYYY年MM月DD日）",
        "service_type": "整型 | 发票类=1、非发票类=2",
        "amount": "浮点型 | 金额（不含税）",
        "tax_amount": "浮点型 | 税额（无税则为0.0）",
        "total_amount": "浮点型 | 总金额",
        "buyer_name": "字符串 | 购买方/乘客名称",
        "buyer_id": "字符串 | 购买方识别号/身份证号",
        "seller_name": "字符串 | 销售方/运输公司名称",
        "seller_id": "字符串 | 销售方识别号",
        "item_name": "字符串 | 项目名称（如*运输服务*、火车票、打车票等）",
        "expense_category": "字符串 | 费用类别（市内交通费/业务招待费/差旅费）"
        "file_name": "字符串 | 文件名字，票据的文件名字，不能为空"
        "file_id": "字符串 | 文件ID，如果为空，生成一个唯一id"
    }
  ]

  【异常处理】
  - 若字段无法识别，赋值为空字符串""
  - 费用类别根据票据性质判断：火车票→差旅费，市内打车→市内交通费
  - 非发票类出行单中会有多个金额，需要进行金额汇总，写入到总金额中
  
  【用户补充说明】
  {{input_question}}

file_prompt: |
  请准确识别输入文件中的票据信息，并输出结构化结果。
  ---
  ### 【票据分类标准】
  票据分为两类：
  1. **发票类（service_type=1）**
     * 必须具备：**发票监制章** 与 **发票号码**
     * 包含但不限于：
       * 增值税专用发票
       * 增值税普通发票
       * 电子普通发票
       * 机打发票
       * 其他具有税务监制章的正式税务发票
  2. **非发票类（service_type=2）**
     * 缺少发票监制章或发票号码的凭证，包括：
       * 行程单、结算单
       * 收据、小票
       * 火车票、机票行程单、打车票
       * 其他非税务发票凭证
  ---
  ### 【字段提取要求】
  对每个文件提取并输出以下字段：
  | 字段名              | 类型  | 说明                          |
  | :--------------- | :-- | :-------------------------- |
  | invoice_type     | 字符串 | 票据标题或类别，如“电子发票（普通发票）”“火车票”“我的出行”等 |
  | invoice_code     | 字符串 | 准确标注为发票号码，为一串数字,如果为发票类绝对不能为空字符串 |
  | issue_date       | 字符串 | 开票日期/出行日期，格式为“YYYY年MM月DD日”  |
  | service_type     | 整型  | 发票类=1，非发票类=2                |
  | amount           | 浮点型 | 金额（不含税）                     |
  | tax_amount       | 浮点型 | 税额（无则为0.0）                  |
  | total_amount     | 浮点型 | 合计金额（含税或总金额）                |
  | buyer_name       | 字符串 | 购买方/乘客姓名                    |
  | buyer_id         | 字符串 | 购买方识别号或身份证号                 |
  | seller_name      | 字符串 | 销售方或运输公司名称                  |
  | seller_id        | 字符串 | 销售方识别号（无则为空）                |
  | item_name        | 字符串 | 商品或服务名称，如“运输服务”“餐饮”等      |
  | expense_category | 字符串 | 费用类别,必填项（固定选项：市内交通费/业务招待费/差旅费）  |
  | file_name        | 字符串 | 文件名（不能为空）                   |
  | file_id          | 字符串 | 文件ID，与输入的文件ID顺序一致           |
  ---
  ### 【识别与判断逻辑】
  1. **发票类判断**
     * 若存在“发票监制章”且包含“发票号码”字段，则为发票类。
     * 例如：“增值税发票”“电子普通发票”等。
  2. **非发票类判断**
     * 缺少上述要素的均为非发票类。
     * 示例：火车票、打车票、机票行程单、收据、小票等。
  3. **金额字段处理**
     * 所有金额类字段以浮点数形式输出。
     * 若无税额，则 `tax_amount=0.0`。
     * 若票据中有多个金额（如行程单），需汇总计算总额并写入 `total_amount`。
  4. **费用类别推断**
     * 火车票、机票 → `差旅费`
     * 打车票、市内出行单 → `市内交通费`
     * 餐饮、娱乐等招待类票据 → `业务招待费`
     * 其他票据 → `其他`
  5. **特殊处理**
     * 火车票、打车票等，`seller_name` 可填写运输公司（如“中国铁路”“滴滴出行”）。
     * 无法识别的字段填空字符串 `""`。
     * 日期未识别时可留空。
  ---
  ### 【输出格式要求】
  严格输出如下 JSON 数组结构，确保字段类型和格式正确,不包含任何额外文本或注释：
  [
    {
      "invoice_type": "",
      "invoice_code": "",
      "issue_date": "",
      "service_type": 1,
      "amount": 0.0,
      "tax_amount": 0.0,
      "total_amount": 0.0,
      "buyer_name": "",
      "buyer_id": "",
      "seller_name": "",
      "seller_id": "",
      "item_name": "",
      "expense_category": "",
      "file_name": "",
      "file_id": ""
    }
  ]
  ---
  ### 【附加说明】
  输入文件ID依次为：{{file_ids}}
  其他说明：{{input_question}}

test_prompt: |
  请根据提供的票据信息
  提取里面详细的内容
